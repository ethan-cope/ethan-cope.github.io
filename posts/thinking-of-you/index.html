<!DOCTYPE html>
<html lang="en-us">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<meta name="theme-color" content="#494f5c">
	<meta name="msapplication-TileColor" content="#494f5c">
<meta itemprop="name" content="ðŸ’¡ SignalBox: DIY Connected Lanterns with MQTT, Adafruit Feather">
<meta itemprop="description" content="Faced with the tradition of family Christmas gift giving, I was thoroughly stumped. I knew I wanted to do something maker-related: I&rsquo;m the only engineer in the family, which tends to amplify the wow factor of any techncal projects :)
After my fallback plan (a Chemex coffee maker) fell through, I knew I had to build these!
the finished product!
These are long-distance friendship lanterns. The idea is, sometimes you want to let a distant friend or family member know that you&rsquo;re thinking of them, even if you don&rsquo;t necessarily want to shoot them a text."><meta itemprop="datePublished" content="2022-12-25T19:04:34-06:00" />
<meta itemprop="dateModified" content="2022-12-25T19:04:34-06:00" />
<meta itemprop="wordCount" content="756">
<meta itemprop="keywords" content="embeddedSystems,Arduino,IoT," /><meta property="og:title" content="ðŸ’¡ SignalBox: DIY Connected Lanterns with MQTT, Adafruit Feather" />
<meta property="og:description" content="Faced with the tradition of family Christmas gift giving, I was thoroughly stumped. I knew I wanted to do something maker-related: I&rsquo;m the only engineer in the family, which tends to amplify the wow factor of any techncal projects :)
After my fallback plan (a Chemex coffee maker) fell through, I knew I had to build these!
the finished product!
These are long-distance friendship lanterns. The idea is, sometimes you want to let a distant friend or family member know that you&rsquo;re thinking of them, even if you don&rsquo;t necessarily want to shoot them a text." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ethan-cope.github.io/posts/thinking-of-you/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-25T19:04:34-06:00" />
<meta property="article:modified_time" content="2022-12-25T19:04:34-06:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="ðŸ’¡ SignalBox: DIY Connected Lanterns with MQTT, Adafruit Feather"/>
<meta name="twitter:description" content="Faced with the tradition of family Christmas gift giving, I was thoroughly stumped. I knew I wanted to do something maker-related: I&rsquo;m the only engineer in the family, which tends to amplify the wow factor of any techncal projects :)
After my fallback plan (a Chemex coffee maker) fell through, I knew I had to build these!
the finished product!
These are long-distance friendship lanterns. The idea is, sometimes you want to let a distant friend or family member know that you&rsquo;re thinking of them, even if you don&rsquo;t necessarily want to shoot them a text."/>

	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
	<link rel="shortcut icon" href="/favicon.ico">

	<title>ðŸ’¡ SignalBox: DIY Connected Lanterns with MQTT, Adafruit Feather</title>
	<link rel="stylesheet" href="https://ethan-cope.github.io/css/style.min.037b6ee8f8c1baab6a3d0a9da11c3ff18a7552471f16c59fd98538d5ce99208b.css" integrity="sha256-A3tu6PjBuqtqPQqdoRw/8Yp1UkcfFsWf2YU41c6ZIIs=" crossorigin="anonymous">
	
</head>

<body id="page">
	
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://ethan-cope.github.io">Hey, I&#39;m Ethan.</a>
				</div>
				<nav class="site-nav hide-in-mobile">
					
				<a href="https://ethan-cope.github.io/posts/">Posts</a>
				<a href="https://ethan-cope.github.io/aboutme/">About</a>

				</nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://github.com/ethan-cope" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a><a href="https://www.linkedin.com/in/ethancope/" target="_blank" rel="noopener me" title="Linkedin"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a><a href="https://twitter.com/" target="_blank" rel="noopener me" title="Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a></span><button id="menu-btn" class="hdr-btn" title="Menu"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://ethan-cope.github.io/posts/">Posts</a></li>
			<li><a href="https://ethan-cope.github.io/aboutme/">About</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster">
		<article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Dec 25, 2022</span></div>
				<h1>ðŸ’¡ SignalBox: DIY Connected Lanterns with MQTT, Adafruit Feather</h1>
			</header>
			<div class="content">
				<p>Faced with the tradition of family Christmas gift giving, I was thoroughly stumped.
I knew I wanted to do something maker-related: I&rsquo;m the only engineer in the family, which tends to amplify the wow factor of any techncal projects :)</p>
<p>After my fallback plan (a Chemex coffee maker) fell through, I knew I had to build these!</p>
<figure><img src="boximg.jpg"
         alt="image"/><figcaption>
            <p>the finished product!</p>
        </figcaption>
</figure>

<p>These are <a href="https://www.instructables.com/DIY-Long-Distance-Best-Friend-Lights/">long-distance friendship lanterns</a>. The idea is, sometimes you want to let a distant friend or family member know that you&rsquo;re thinking of them, even if you don&rsquo;t necessarily want to shoot them a text. The lanterns couldn&rsquo;t be simpler to use: turning on your lantern also turns on your friends&rsquo; lantern, no matter where they are in the world.</p>
<h2 id="logic">Logic<a href="#logic" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<p>This project has multiple boxes (one for each family member), all of which can send &ldquo;thinking of you&rdquo; messages to each other. For example, if I&rsquo;m currently thinking about my dad, I can make his box light up from my box! But how does he know it&rsquo;s me that&rsquo;s thinking of him, and not someone else? To solve this, each box is assigned a color, which is associated with the box owner. So when I send a message to my dad, his box will become my color. To send a message, I can press the push button, which cycles through all the possible colors to send to. Not pressing the button for 2 seconds will send the message, lighting up the senders&rsquo; and receivers&rsquo; box for 2 hours. Confusing? I made a diagram.</p>
<figure><img src="box.drawio.png"
         alt="image"/><figcaption>
            <p>Feather Board (image credit to Adafruit)</p>
        </figcaption>
</figure>

<h2 id="the-code">The Code<a href="#the-code" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<h3 id="mqtt">MQTT<a href="#mqtt" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>I knew that <a href="https://mqtt.org/">MQTT</a> would be a great fit for this project: it even bills itself as &ldquo;The standard for IoT messaging&rdquo;. It&rsquo;s lightweight, bidirectional, and requires minimal infrastructure.  Without getting too into the weeds, every message, or <strong>post</strong>, is published to a <strong>topic</strong>. Once a message is published to a topic, all other devices subscribed to the same topic receive the new message. By making a topic for each box, (i.e. the <em>green</em> box will receive any posts sent to the <em>green</em> topic), anyone&rsquo;s post to that box&rsquo;s topic will be interpreted as a message to turn that box on.</p>
<p>Of course, this system still requires a central server, called a broker, to make sure messages get to where they&rsquo;re sent. Luckily, <a href="https://console.hivemq.cloud/">HiveMQ</a> is one such server with a generous free tier that this project&rsquo;s constraints fall well within. It also <em>HAD</em> a <a href="https://console.hivemq.cloud/clients/arduino-esp8266?uuid=c689cd9ab0cf406bbc142988277304d9">super neat tutorial</a> for getting started on an Arduino, but the page seems to be broken. Either way, my implementation is based on their sample publish-receive code.</p>
<h3 id="arduino">Arduino<a href="#arduino" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h3>
<p>Everyone and their mother knows that Arduino is the way to go for simple MCU programming. Abundant libraries handle all of the hard stuff, all you have to do is bring the logic. Besides some Linux issues (Manjaro didn&rsquo;t seem to like my UDEV rules, solution <a href="https://playground.arduino.cc/Linux/All/#Permission">here</a>), everything was simple to set up.</p>
<p>As for libraries, I utilized <a href="https://github.com/FastLED/FastLED/wiki/Basic-usage">FastLED</a> to program simple light animations in the Neopixel strip. ESP8266WiFi is obviously needed to connect the device to the network, and other boilerplate libraries such as <a href="">PubSubClient</a> and <a href="https://www.arduino.cc/reference/en/libraries/littlefs_esp32/">LittleFS</a> were used to authenticate with the HiveMQ server.</p>
<h2 id="parts-selection">Parts Selection<a href="#parts-selection" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>
<figure><img src="feather.png"
         alt="image"/><figcaption>
            <p>Feather Board (image credit to Adafruit)</p>
        </figcaption>
</figure>

<p>I am blessed to live within driving distance of Micro Center, a legendary PC superstore with a sizeable DIY/maker section.
I knew I needed an Arduino board with wifi support, and Micro Center had the <a href="https://www.adafruit.com/product/2821">Adafruit Feather Huzzah</a> in stock.
This board&rsquo;s specs are overkill for this application, but it definitely does the job.
Also from the Micro Center haul was a strip of NeoPixels, and some push-button switches for control.
Add in a clear case from the container store, and we&rsquo;re ready to rock!</p>
<ul>
<li><a href="https://www.adafruit.com/product/2821">Adafruit Feather Huzzah ESP8266</a></li>
<li><a href="https://www.microcenter.com/product/459723/adafruit-industries-neopixel-digital-rgb-led-strip-white-60-led">Adafruit NeoPixel RGB LED Strip</a></li>
<li>Any momentary push-button switches</li>
<li><a href="https://www.containerstore.com/s/gift-packaging/gift-boxes/clear-amac-boxes/12d?productId=10003497">Clear AMAC enclosure</a></li>
</ul>
<h2 id="does-it-work">Does it work?<a href="#does-it-work" class="anchor" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M15 7h3a5 5 0 0 1 5 5 5 5 0 0 1-5 5h-3m-6 0H6a5 5 0 0 1-5-5 5 5 0 0 1 5-5h3"></path><line x1="8" y1="12" x2="16" y2="12"></line></svg></a></h2>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="https://www.youtube.com/embed/nyXzglq0ATc" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen title="Quick Demo of Signalbox"></iframe>
</div>

<p>In short, yeah! The only issues I&rsquo;ve run into are logging related. When I rolled these boxes out, I didn&rsquo;t include any method of logging messages. This makes it very difficult to troubleshoot the boxes, since I simply don&rsquo;t know what&rsquo;s happening at any given time. Throw in the fact that I have no method of remotely updating the boxes, even small logic bugs are difficult to fix. But after being rolled out for 3 months, all the reported issues can be fixed just by power cycling the device, so I&rsquo;d call this a win! If you find any issues with my programming, don&rsquo;t hesitate to hit me with a pull request!</p>

			</div>
			<hr class="post-end">
			<footer class="post-info">
				<p>
					<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://ethan-cope.github.io/tags/embeddedsystems">embeddedSystems</a></span><span class="tag"><a href="https://ethan-cope.github.io/tags/arduino">Arduino</a></span><span class="tag"><a href="https://ethan-cope.github.io/tags/iot">IoT</a></span>
				</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>756 Words</p>
				<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2022-12-25 19:04 -0600</p>
			</footer>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://ethan-cope.github.io/posts/ge7/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;Newer</span><br><span>Boss Pedal Switching Issues? Try This! (Boss GE-7 Modding)</span>
			</a>
			<a class="prev-post" href="https://ethan-cope.github.io/posts/auto-grader-update/">
				<span class="post-nav-label">Older&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>Spelling Test Grader [UPDATE]</span>
			</a>
		</div>
		<div id="comments" class="thin">
</div>
	</main>

	<footer id="site-footer" class="section-inner thin animated fadeIn faster">
		<p>&copy; 2023 <a href="https://ethan-cope.github.io">Ethan Cope</a> &#183; <a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a></p>
		<p>
			Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> &#183; Theme <a href="https://github.com/Track3/hermit" target="_blank" rel="noopener">Hermit</a> &#183; <a href="https://ethan-cope.github.io/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></a>
		</p>
	</footer>



	<script src="https://ethan-cope.github.io/js/bundle.min.580988ed2982bcbb74a1773c7abea97b43e4c43b9324e10cda0813ec6ec4bb67.js" integrity="sha256-WAmI7SmCvLt0oXc8er6pe0PkxDuTJOEM2ggT7G7Eu2c=" crossorigin="anonymous"></script>
	

</body>

</html>
